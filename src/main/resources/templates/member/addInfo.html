<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>정보등록</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <style>
        #addInfo{ display: flex; flex-direction: column; align-items: center; }
        #addInfo .container { width : 100%; height : 100%; overflow : scroll; display : flex; flex-direction:column; justify-content:left; }
        #addInfo .container .top{ width : 90%; padding : 15px 5%; border-bottom : 1px solid #909090; }
        #addInfo .container .middle{ width : 90%; padding : 0 5%; }
        #addInfo .container .middle h2{ padding : 20px 0 10px 0; }
        #addInfo .container .middle p{ min-height : 15px; padding-top : 10px; font-size : 12px; word-break: keep-all; line-height : 1.4; font-weight: 100;}
        #addInfo .container .middle p.memAdvice{ font-size : 10px; color : #ff9d2a; padding : 0; padding : 0 0 10px 10px; }
        #addInfo .container .middle input{ margin : 7px 0 3px 0; font-size: 16px; font-weight: 400; letter-spacing: -1px; padding : 15px; width : 100%; background-color: inherit; border-radius : 10px;}
        #addInfo .container .middle input:invalid{ border-color : #ff9d2a; }
        #addInfo .container .middle button{ background-color: #ff9d2a; opacity: 1; border-color: #ff9d2a; font-weight : 500; font-size : 16px; transition : 0.3s; opacity : 1; font-size: 17px; font-weight: 400; letter-spacing: -1px; padding : 15px; width : 100%; background-color: inherit; border : 1px solid #fff; border-radius : 10px; }
        #addInfo .container .middle button:disabled, button[disabled]{ background-color: #43474f; border-color: #43474f; opacity : 1; font-weight : 500; font-size : 16px; }
    </style>
</head>
<body id="addInfo">
<div class="container">
    <div class="top">
        <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 34 34" fill="none" onclick="window.history.back()">
            <path d="M21.25 8.5L12.75 17L21.25 25.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>
    <div class="middle">
        <h2>사용자 정보를 입력해 주세요.</h2>
        <p>한라봉마켓을 이용하기 위해선 기본 정보가 필요해요.</p>
        <div id="memUsernameDiv">
            <p>아이디</p>
            <input type="text" id="memUsername"/>
            <p id="memUsernameAdvice" class="memAdvice"> </p>
        </div>
        <div id="memPasswordDiv">
            <p>비밀번호</p>
            <input type="password" id="memPassword"/>
            <p id="memPasswordAdvice" class="memAdvice"> </p>
        </div>
        <div id="memPasswordCheckDiv">
            <p>비밀번호 확인</p>
            <input type="password" id="memPasswordCheck"/>
            <p id="memPasswordCheckAdvice" class="memAdvice"> </p>
        </div>
        <div id="memNameDiv">
            <p>이름</p>
            <input type="text" id="memName"/>
            <p id="memNameAdvice" class="memAdvice"> </p>
        </div>
        <div id="memNicknameDiv">
            <p>닉네임</p>
            <input type="text" id="memNickname"/>
            <p id="memNicknameAdvice" class="memAdvice"> </p>
        </div>
        <div id="memPhoneDiv">
            <p>전화번호</p>
            <input type="text" id="memPhone" disabled/>
            <p id="memPhoneAdvice" class="memAdvice"> </p>
        </div>
        <div id="memEmailDiv">
            <p>이메일</p>
            <input type="email" id="memEmail"/>
            <p id="memEmailAdvice" class="memAdvice">비밀번호를 찾기위해 필요해요! 사용중인 이메일을 적어주세요</p>
        </div>
        <button id="btn_submit" disabled="true" onclick="submit();">가입하기</button>
    </div>
</div>
<script>
    $(document).ready(function(){
        const urlSearchParams = new URLSearchParams(location.search);
        const memNo = urlSearchParams.get('memNo');

        // 회원 기입된 정보 조회
        $.ajax({
            type: "GET",
            url: "/api/v1/mem/find-by-id",
            data: {memNo: memNo}
        }).done(function(result){
            if(result.memUsername){
                $("#memUsername").val(result.memUsername);
                $("#memUsernameDiv").css("display","none");
            }
            if(result.memPassword){
                $("#memPassword").val(result.memPassword);
                $("#memPasswordCheck").val(result.memPassword);
                $("#memPasswordDiv").css("display","none");
                $("#memPasswordCheckDiv").css("display","none");
            }
            if(result.memNickname){
                $("#memNickname").val(result.memNickname);
            }
            if(result.memEmail){
                $("#memEmail").val(result.memEmail);
            }
            if(result.memPhone){
                $("#memPhone").val(result.memPhone);
            }
        })
    })

    // 가입하기
    function submit(){
        var check = $("#memUsername").val();
        var regExp = /^[a-z]+[a-z0-9]{5,19}$/g;
        if(!regExp.test(check) ){
            $("#memUsernameAdvice").text("영문자로 시작하는 영문자 또는 숫자 6~20자");
            $("#memUsername").focus();
            return;
        }
        var check = $("#memPassword").val();
        var regExp = /^(?=.*[a-zA-z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\(\\)\-_=+]).{8,16}$/;
        if(!regExp.test(check) ){
            $("#memPasswordAdvice").text("8 ~ 16자 영문, 숫자, 특수문자를 최소 한가지씩 조합");
            $("#memPassword").focus();
            return;
        }
        var check2 = $("#memPasswordCheck").val();
        if(check!=check2){
            $("#memPasswordCheckAdvice").text("동일한 비밀번호가 아닙니다.");
            $("#memPasswordCheck").focus();
            return;
        }
        var check = $("#memEmail").val();
        var regExp = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
        if(!regExp.test(check) ){
            $("#memEmailAdvice").text("올바른 이메일 형식이 아닙니다.");
            $("#memEmail").focus();
            return;
        }
        var check = $("#memName").val();
        var regExp = /^[ㄱ-ㅎ|가-힣]+$/;
        if(!regExp.test(check) ){
            $("#memNameAdvice").text("이름은 한글만 입력 가능합니다.");
            $("#memName").focus();
            return;
        }
        console.log("가입 ajax");
    }

    // 가입하기 버튼 활성화
    function activateBtnSubmit(){
        if(!$("#memUsername").val()){
            $("#btn_submit").attr("disabled",true);
        }else if(!$("#memPassword").val()){
            $("#btn_submit").attr("disabled",true);
        }else if(!$("#memPasswordCheck").val()){
            $("#btn_submit").attr("disabled",true);
        }else if(!$("#memName").val()){
            $("#btn_submit").attr("disabled",true);
        }else if(!$("#memNickname").val()){
            $("#btn_submit").attr("disabled",true);
        }else if(!$("#memEmail").val()){
            $("#btn_submit").attr("disabled",true);
        }else{
            $("#btn_submit").attr("disabled",false);
        }
    }

    // 아이디 검증
    $("#memUsername").on("input", function() {
        let check = $("#memUsername").val();
        var regExp = /^[a-z]+[a-z0-9]{5,19}$/g;
        if(!regExp.test(check) ){
            $("#memUsernameAdvice").text("영문자로 시작하는 영문자 또는 숫자 6~20자");
        }else{
            $("#memUsernameAdvice").text(" ");
        }
        activateBtnSubmit();
    });
    // 비밀번호 검증
    $("#memPassword").on("input", function() {
        let check = $("#memPassword").val();
        var regExp = /^(?=.*[a-zA-z])(?=.*[0-9])(?=.*[$`~!@$!%*#^?&\\(\\)\-_=+]).{8,16}$/;
        if(!regExp.test(check) ){
            $("#memPasswordAdvice").text("8 ~ 16자 영문, 숫자, 특수문자를 최소 한가지씩 조합");
        }else{
            $("#memPasswordAdvice").text(" ");
        }
        activateBtnSubmit();
    });
    // 비밀번호 확인 검증
    $("#memPasswordCheck").on("input", function() {
        let pwd2 = $("#memPassword").val();
        let pwd1 = $("#memPasswordCheck").val();
        if(pwd1!=pwd2){
            $("#memPasswordCheckAdvice").text("동일한 비밀번호가 아닙니다.");
        }else{
            $("#memPasswordCheckAdvice").text(" ");
        }
        activateBtnSubmit();
    });
    // 이메일 검증
    $("#memEmail").on("input", function() {
        let check = $("#memEmail").val();
        var regExp = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
        if(!regExp.test(check) ){
            $("#memEmailAdvice").text("올바른 이메일 형식이 아닙니다.");
        }else{
            $("#memEmailAdvice").text(" ");
        }
        activateBtnSubmit();
    });
    // 이름 검증
    $("#memName").on("input", function() {
        let check = $("#memName").val();
        var regExp = /^[ㄱ-ㅎ|가-힣]+$/;
        if(!regExp.test(check) ){
            $("#memNameAdvice").text("이름은 한글만 입력 가능합니다.");
        }else{
            $("#memNameAdvice").text(" ");
        }
        activateBtnSubmit();
    });
</script>
</body>
</html>